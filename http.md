 

 

**HTTP** (англ. *HyperText Transfer Protocol*, “протокол передачи гипертекста”)
- протокол, используемый для передачи данных, изначально только гипертекстовых
документов, сейчас протокол также используется для передачи произвольных данных,
таких как аудио и видео.

Программное обеспечение, необходимое для работы с протоколом:

1.  Программа-клиент  - инициирует соединение, посылает сообщения запроса.

2.  Сервер - находится в ожидании запроса, обрабатывает его и посылает сообщение
    ответа.

3.  Прокси-сервер - используется в качестве транспортной службы.

 

Структура протокола
===================

 

Любое HTTP-сообщение состоит из трёх частей:

1.  Стартовая строка
    ([англ.](https://ru.wikipedia.org/wiki/%D0%90%D0%BD%D0%B3%D0%BB%D0%B8%D0%B9%D1%81%D0%BA%D0%B8%D0%B9_%D1%8F%D0%B7%D1%8B%D0%BA)
    *Starting line*) — определяет тип сообщения, обязательна для всех сообщений

2.  Заголовок
    ([англ.](https://ru.wikipedia.org/wiki/%D0%90%D0%BD%D0%B3%D0%BB%D0%B8%D0%B9%D1%81%D0%BA%D0%B8%D0%B9_%D1%8F%D0%B7%D1%8B%D0%BA)
    *Header*) — характеризуют тело сообщения, параметры передачи и прочие
    сведения; в версии протокола 0.9 может отсутствовать, в версии 1.1
    обязательным является заголовок Host.

3.  Тело сообщения
    ([англ.](https://ru.wikipedia.org/wiki/%D0%90%D0%BD%D0%B3%D0%BB%D0%B8%D0%B9%D1%81%D0%BA%D0%B8%D0%B9_%D1%8F%D0%B7%D1%8B%D0%BA)
    *Message Body*) — непосредственно данные сообщения. Отделяется от заголовков
    пустой строкой, не является обязательным элементом.

 

Диалог “клиент - сервер”
------------------------

 

Вся работа протокола состоит в обмене сообщениями. Ниже приведён пример такого
обмена с разбором основных частей диалога.

 

*Пример запрос клиента*:

 

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
GET /wiki/страница HTTP/1.1 // стартовая строка

Host: ru.wikipedia.org   // начало заголовка 

User-Agent: Mozilla/5.0 (X11; U; Linux i686; ru; rv:1.9b5) Gecko/2008050509 Firefox/3.0b5

Accept: text/html

Connection: close // конец заголовка 

(пустая строка)  
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

 

### Стартовая строка

 

Стартовая строка запроса для протокола версии 1.1  имеет следующий вид

 

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 <Метод> <URI> HTTP/<Версия>
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

 

**Метод** - название запроса, одно слово заглавными буквами, чувствительно к
регистру. Всеми серверами должны поддерживаться методы `GET`и `HEAD`.

Возможные методы:

-   **GET** - используется для запроса содержимого указанного ресурса,  также
    используется для начала какого-либо процесса. В теле ответа на метод -
    информация о ходе выполнения процесса. Также бывают условные **GET**
    (содержат заголовки If-Modified-Since, If-Match, If-Range), которые
    определяют, изменялся ли ресурс с указанной даты, и частичные GET, благодаря
    которым может быть осуществлена докачка файлов.

-   **HEAD** - аналогичен методу  GET, однако в ответе сервера отсутствует тело.
    Применяется для извлечения метаданных, валидации ресурса и проверки наличия
    изменений с момента последнего обращения.

-   **OPTIONS** - используется для получения от сервера списка поддерживаемых
    методов, поддерживаемых расширений, параметров соединения для конкретного
    ресурса.

-   **POST** - применяется для передачи пользовательских данных заданному
    ресурсу.

-   **PUT** - используется для загрузки содержимого запроса на указанный в
    запросе URI.

-   **DELETE** - удаляет указанный ресурс.

 

**URI**
 ([англ.](https://ru.wikipedia.org/wiki/%D0%90%D0%BD%D0%B3%D0%BB%D0%B8%D0%B9%D1%81%D0%BA%D0%B8%D0%B9_%D1%8F%D0%B7%D1%8B%D0%BA)
*Uniform Resource Identifier*, “унифицированный идентификатор ресурса”) -
символьная строка, позволяющая идентифицировать какой-либо ресурс, определяет
путь к запрашиваемому документу.

 

**Версия** - пара разделённых точкой цифр.

 

*Пример ответ сервера*:

 

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
HTTP/1.1 200 OK  // стартовая строка

Date: Wed, 11 Feb 2009 11:20:59 GMT  // начало заголовка 

Server: Apache

X-Powered-By: PHP/5.2.4-2ubuntu5wm1

Last-Modified: Wed, 11 Feb 2009 11:20:59 GMT

Content-Language: ru

Content-Type: text/html; charset=utf-8

Content-Length: 1234

Connection: close // конец заголовка

(пустая строка)

(далее следует запрошенная страница в HTML)   // тело сообщения
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

 

Стартовая строка ответа сервера имеет следующий вид:

 

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
<HTTP/Версия> <КодСостояния> <Пояснение>
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

 

**Код состояния** - целое число из трёх цифр, первая цифра указывает на класс
состояния. Набор кодов является стандартом, они описаны в спецификации RFC.
Клиент с кодом состояния получает результат своего запроса и определяет свои
действия в соответствии с классом кода.

 

В настоящее время есть пять классов кодов состояния.

1.  [1xx ]*Informational* («Информационный»)  - состояние процесса передачи
    данных.

2.  *2xx Success* («Успех») - состояние успешного принятия и обработки запроса
    клиента.

3.  *3xx Redirection* («Перенаправление») - сообщение, что успешное выполнение
    операции возможно по другому URI.

4.  *4xx Client Error* («Ошибка клиента») - ошибка со стороны клиента.

5.  *5xx Server Error* («Ошибка сервера») - ошибка со стороны сервера.

 

За кодом ответа через пробел следует поясняющая фраза на английском, в которой
поясняется причина именно такого ответа сервера.

Пример:

 

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
403 Access allowed only for registered users
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

 

### Заголовок

 

Заголовок в сообщении имеет вид “*параметр : значение*”. Заголовок отделяется от
тела сообщения хотя бы одной пустой строкой. Все основные заголовки описаны в
спецификации RFC, однако есть возможность создавать свои, в таком случае к имени
заголовка добавляется префикс “х-”.

Все заголовки разделяются на четыре основных группы:

1.  *General Headers* («Основные заголовки») — могут включаться в любое
    сообщение клиента и сервера.

2.  *Request Headers* («Заголовки запроса») — используются только в запросах
    клиента.

3.  *Response Headers* («Заголовки ответа») — только для ответов от сервера.

4.  *Entity Headers* («Заголовки сущности») — сопровождают каждую сущность
    сообщения.

 

### Тело сообщения (`message body)`

Не является обязательным элементом. Если тело сообщения есть, то в нём
передаются гипертекстовые данные, например, html-код страницы.

 

Основные механизмы протокола
============================

В качестве основных механизмов протокола можно привести несколько:

1.  Частичные `GET`

2.  Условные `GET`

3.  Согласование содержимого

4.  Множественное сожержимое

 

Частичные GET
-------------

С помощью данного метода есть возможность запрашивать не все сожержимое ресурса,
а только указанные фаргменты, что позволяет использоватье этот метод для докачки
файлов и параллельного скачивания в нескольких потоках.

 

Условные GET
------------

Метод применяется, если сообщение запроса включает в себя поле
заголовка `If-Modified-Since`. В ответ на «условный `GET`», тело запрашиваемого
ресурса передаётся только если он изменялся после даты, указанной в
заголовке `If-Modified-Since`. Метод используется для избежания переачи
избыточной информации и разгрузки сети.

 

Согласование содержимого
------------------------

Данный механизм автоматического определяет, какой ресурс необходимо возвращать
при наличии нескольких разнотипных версий документа. 

В случае согласования, управляемого сервером, для выдачи необходимой версии
ресурса анализируются заголовки запроса клиента, такие как
`Accept`, `Accept-Charset`, `Accept-Encoding`, `Accept-Languages` и `User-Agent.`Также
может анализироваться географического расположение клиента с пмощью удалённого
IP-адреса.

В случае согласования, управляемого клиентом, в ответ на запрос сервер
возвращает сообщение с кодом состояния `300` (Multiple Choices) или `406`(Not
Acceptable) и список вариантов, среди которых пользователь выбирает подходящий.

Также существует так называемое прозрачное согласование, в котором используется
общий кэш со списком вариантов. Если кэш понимает все эти варианты, то он сам
делает выбор, как при управляемом сервером согласовании. 

 

Множественное содержимое
------------------------

Протокол HTTP поддерживает передачу нескольких сущностей в пределах одного
сообщения. Причём сущности могут передаваться не только в виде одноуровневой
последовательности, но и в виде иерархии с вложением элементов друг в друга. Для
обозначения множественного содержимого используются медиатипы `multipart/*`.
Работа с такими типами осуществляется по общим правилам, в случае, если
получателю не известно как работать с типом, то он обрабатывает его так же,
как `multipart/mixed`.

 

 

Особенности протокола
=====================

Одними из особенностей протокола являются:

1.  Для каждого запроса устанавливается отдельная TCP-сессия, разрыв сессии
    происходит после каждого запроса.

2.  Сервер перед передачей данных отправляет заголовок “*Content-Type:
    тип/подтип*“, что позволяет клиенту однозначно определить, как обрабатывать
    принятые данные.

 

Ссылки на использованные источники

1.  <https://ru.wikipedia.org/wiki/HTTP>

2.  <https://habrahabr.ru/post/215117/>

3.  <https://2ip.ru/article/proxy/>
